# Infra Repository

Репозиторий для инфраструктурных компонентов проекта.

## RabbitMQ

### Запуск

1. Скопируйте `.env.example` в `.env` и настройте параметры:
```bash
cp .env.example .env
```

2. Запустите RabbitMQ:
```bash
docker-compose up -d
```

3. Проверьте статус:
```bash
docker-compose ps
```

### Доступ

- **AMQP порт**: `5672` - для подключения микросервисов
- **Management UI**: http://localhost:15672
  - Логин: `admin` (по умолчанию)
  - Пароль: `admin` (по умолчанию)

### Подключение микросервисов

Используйте следующие параметры подключения:

```yaml
host: localhost  # или IP сервера при удаленном подключении
port: 5672
username: admin
password: admin
vhost: /
```

### Остановка

```bash
docker-compose down
```

Для удаления данных (volumes):
```bash
docker-compose down -v
```

### Переменные окружения

Настройте в файле `.env`:

- `RABBITMQ_USER` - пользователь RabbitMQ (по умолчанию: `admin`)
- `RABBITMQ_PASSWORD` - пароль RabbitMQ (по умолчанию: `admin`)
- `RABBITMQ_VHOST` - виртуальный хост (по умолчанию: `/`)

### Деплой на сервер

#### Автоматический деплой через GitHub Actions

При пуше в `main`/`master` ветку автоматически запускается деплой на VPS.

**Настройка секретов в GitHub:**

1. Перейдите в Settings → Secrets and variables → Actions
2. Добавьте следующие секреты:

   **Для подключения к серверу:**
   - `DEPLOY_SSH_KEY` - приватный SSH ключ для подключения к серверу (содержимое файла `~/.ssh/id_rsa` или другого приватного ключа)
   - `DEPLOY_HOST` - IP адрес или домен вашего VPS сервера (например: `192.168.1.100` или `rabbitmq.example.com`)
   - `DEPLOY_USER` - имя пользователя для SSH подключения (например: `root` или `ubuntu`)

   **Для настройки RabbitMQ:**
   - `RABBITMQ_USER` - **придумайте** имя пользователя RabbitMQ (например: `admin`, `rabbitmq_user`)
   - `RABBITMQ_PASSWORD` - **придумайте** надежный пароль для RabbitMQ (например: `MySecureP@ssw0rd123`)
   - `RABBITMQ_VHOST` - **ОПЦИОНАЛЬНО**: виртуальный хост (если не указать, будет использовано `/` по умолчанию)

   > **Важно**: Значения `RABBITMQ_USER` и `RABBITMQ_PASSWORD` вы придумываете сами - это не существующие учетные данные, а те, которые будут созданы при первом запуске RabbitMQ на сервере.

**Требования на сервере:**
- Установлены Docker и Docker Compose
- Пользователь имеет права для запуска Docker команд
- SSH ключ настроен для доступа

#### Ручной деплой

1. Склонируйте репозиторий на сервер
2. Настройте `.env` файл с продакшн параметрами
3. Запустите: `docker-compose up -d`

**Важно**: Измените пароль по умолчанию перед деплоем на продакшн!